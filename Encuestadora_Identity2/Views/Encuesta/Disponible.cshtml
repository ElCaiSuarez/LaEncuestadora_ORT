@model IEnumerable<Encuestadora_Identity2.Models.Encuesta>

@{
    ViewData["Title"] = "Disponibles";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Encuestas Disponibles</h1>

<p>
    @*<a class="btn-link" href="/Identity/Account/Manage">Volver a Mi Perfil</a>*@
    <button type="button" onclick="window.open('/Identity/Account/Manage', '_self');" class="btn btn-secondary">Volver a Mi Perfil</button>
</p>
<table>
    <thead class="btn btn-primary col-12" >
        <tr class="col-12" style="display:inline-table">
            <th class="col-2 text-center">
                Nombre
            </th>
            <th class="col-2  text-center">
                Publicacion
            </th>
            <th class="col-2  text-center">
                Vencimiento
            </th>
            <th class="col-2  text-center">
                Preguntas
            </th>
            <th class="col-2  text-center">
                Puntos
            </th>
            <th class="col-2  text-center"></th>
        </tr>
    </thead>
    <tbody class="btn bg-light col-12">
        @*RECORRO ENCUESTAS*@
        @foreach (var item in Model)
        {
            //VALIDO QUE CADA ENCUESTA NO ESTE VENCIDA Y TENGA PREGUNTAS
            if (/*item.datetimeVencimientoEncuesta > DateTime.Now && */item.preguntas.Count > 0)
            {
                var encuestaCompleta = true;
                var i = 0;
                var preguntas = item.preguntas.ToList();
                //VALIDO QUE CADA PREGUNTA TENGA OPCIONES
                while (i < preguntas.Count && encuestaCompleta)
                {
                    if (preguntas[i].opciones.Count <= 0)
                    {
                        encuestaCompleta = false;
                    }
                    else
                    {
                        i++;
                    }
                }
                //SI ESTA COMPLETA MUESTRO LA ENCUESTA
                if (encuestaCompleta)
                {

                    <tr class="col-12"  style="display:inline-table">
                        <td class="col-2 text-center">
                            @Html.DisplayFor(modelItem => item.tituloEncuesta)
                        </td>
                        <td class="col-2 text-center">
                            @Html.DisplayFor(modelItem => item.datetimeCreacionEncuesta)
                        </td>
                        <td class="col-2 text-center">
                            @Html.DisplayFor(modelItem => item.datetimeVencimientoEncuesta)
                        </td>
                        <th class="col-2 text-center">
                            @*AGREGAR preguntas.count*@
                            @item.preguntas.Count
                        </th>
                        @if (item.puntosEncuesta == PuntosEncuesta.ENCUESTA_ORO)
                        {
                            <td class="col-2">
                                <p class="btn btn-warning text-black-50 font-weight-bold" style="display:inline">@Html.DisplayFor(modelItem => item.puntosEncuesta)</p>
                            </td>
                        }
                        else if (item.puntosEncuesta == PuntosEncuesta.ENCUESTA_PLATA)
                        {
                            <td class="col-2">
                                <p class="btn btn-primary" style="display:inline">@Html.DisplayFor(modelItem => item.puntosEncuesta)</p>
                            </td>
                        }
                        else
                        {
                            <td class="col-2">
                                @Html.DisplayFor(modelItem => item.puntosEncuesta)
                            </td>
                        }
                        <td class="col-2">
                            @*<a class="text-white-50" href="/EncuestaRespondida/ResponderPreguntas?EncuestaId=@item.EncuestaId&&userName=@User.Identity.Name">Responder</a>*@
                            <button type="button" onclick="window.open('/EncuestaRespondida/ResponderPreguntas?EncuestaId=@item.EncuestaId&&userName=@User.Identity.Name', '_self');" class="btn btn-success">Responder</button>
                        </td>
                    </tr>
                }

            }
        }
    </tbody>
</table>

